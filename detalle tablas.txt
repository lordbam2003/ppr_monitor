Registro de Cambios Recientes - Cartera de Servicios
Fecha: 2025-10-07

Problema resuelto: Visualizaci√≥n de datos de cartera de servicios

1. Archivo: app/static/js/preview.js
   - L√≠nea modificada: A√±adida visibilidad del contenedor para datos de cartera
   - Descripci√≥n: Se agreg√≥ document.getElementById('previewContainer').classList.remove('d-none'); 
     en la funci√≥n displayCarteraPreviewData para que los datos procesados se muestren en la interfaz
   
   - L√≠nea modificada: Cambio de redirecci√≥n post-confirmaci√≥n
   - Descripci√≥n: Se cambi√≥ la redirecci√≥n de /cartera a /transversal_data en la funci√≥n commitPreviewData 
     para que sea consistente con la estructura existente de la aplicaci√≥n

2. Archivo: app/api/v1/cartera.py
   - L√≠nea modificada: Cambio en el endpoint de confirmaci√≥n
   - Descripci√≥n: Se corrigi√≥ c√≥mo se pasan los datos al servicio de almacenamiento para que se extraiga 
     correctamente el array de cartera de la estructura de datos (de preview_data['cartera_data']['cartera'] 
     en lugar de directamente de preview_data['cartera'])

Entidades principales

Programa Presupuestal (PPR)

id_ppr

codigo_ppr (ej. 002)

nombre_ppr (ej. Salud Materno Neonatal)

anio

estado (activo, cerrado)

Producto

id_producto

codigo_producto

nombre_producto

FK ‚Üí id_ppr

Actividad

id_actividad

codigo_actividad

nombre_actividad

FK ‚Üí id_producto

Subproducto

id_subproducto

codigo_subproducto

nombre_subproducto

Unidad de medida (ej. persona, familia, caso tratado)

FK ‚Üí id_actividad

Programaci√≥n / Ejecuci√≥n (PPR)

id_prog_ppr

id_subproducto

anio

meta_anual

Campos mensuales (ej. prog_ene, ejec_ene, ‚Ä¶ prog_dic, ejec_dic)

Programaci√≥n / Ejecuci√≥n (CEPLAN)

id_prog_ceplan

id_subproducto (clave de cruce con PPR)

anio

Campos mensuales (prog_ene, ejec_ene, ‚Ä¶ prog_dic, ejec_dic)

Diferencias / Monitoreo

id_diferencia

id_subproducto

anio

Campos de diferencia mensual (ej. dif_prog_ene, dif_ejec_ene, etc.)

Estado (ok, alerta, pendiente revisi√≥n)

Usuario

id_usuario

nombre

rol (Administrador / Responsable PPR / Responsable Planificaci√≥n)

Relaci√≥n N:M con PPR (porque un PPR puede tener varios responsables y un usuario puede tener m√°s de un PPR asignado)

üìå Relaciones principales

Un PPR tiene varios Productos.

Un Producto tiene varias Actividades.

Una Actividad tiene varios Subproductos.

Cada Subproducto tiene metas y cronogramas (PPR).

Cada Subproducto tambi√©n tiene datos CEPLAN (oficiales).

Los responsables se asignan a nivel de PPR (1:N o N:M seg√∫n el caso).

Los reportes de diferencias se generan a nivel de Subproducto por a√±o.

üìå Vista del modelo (simplificada)
PPR ‚îÄ‚îÄ< Producto ‚îÄ‚îÄ< Actividad ‚îÄ‚îÄ< Subproducto ‚îÄ‚îÄ< Programaci√≥nPPR
                                              		            ‚îî‚îÄ< Programaci√≥nCEPLAN
                                              ‚îî‚îÄ< Diferencias
Usuario ‚îÄ‚îÄ< Asignaci√≥n ‚îÄ‚îÄ< PPR
